<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
    </head>
    <!-- <script data-main="scripts/main" src="js/require.js"></script> -->
    <script type="text/javascript" src="js/libs/knockout.js"></script>
    <script type="text/javascript" src="js/libs/tabletop.js"></script>
    <script type="module" src="js/main.js"></script>
    <link rel="stylesheet" href="css/main.css">
    <body>
        <div id="loaderDiv" class="pageDiv" data-bind="visible: isLoading">
            <div class="loader"></div>
        </div> 

        <div class="modal" data-bind="visible: showModal, click: hideModal">
            <div class="modalContainer">
                <div data-bind="template: modalTemplate"></div>
            </div>
        </div>

        <div id="startDiv" class="pageDiv" data-bind="visible: isStartPhase">
            <h1>START PHASE</h1>
            <div>
                Enter in the number of players, and select your class. One unique class per player. <br>
                The available classes listed below show class stat ratings, not the actual stat.
            </div>

            <div id="startDivContainer">
                How many players? <input data-bind="value: playersValue" />

                <div class="classesDiv" data-bind="foreach: classObjects">
                    <div class="classDiv">
                        <div class="className" data-bind="text: $data.className"></div>
                        <div><span class="cTitle">Attack:</span><span data-bind="text: $data.attack, css: $parent.cValueCSS($data.attack)"></span></div>
                        <div><span class="cTitle">Defense:</span><span data-bind="text: $data.defense, css: $parent.cValueCSS($data.defense)"></span></div>
                        <div><span class="cTitle">HP:</span><span data-bind="text: $data.hp, css: $parent.cValueCSS($data.hp)"></span></div>
                        <div><span class="cTitle">AP:</span><span data-bind="text: $data.ap, css: $parent.cValueCSS($data.ap)"></span></div>
                        <div><span class="cTitle">Hand:</span><span data-bind="text: $data.hand, css: $parent.cValueCSS($data.hand)"></span></div>
                    </div>
                </div>

                <div class="startPDiv" data-bind="visible: playersValue() >= 1">
                    Player 1: <select data-bind="options: availableClasses, value: p1Class"></select>
                </div>
                <div class="startPDiv" data-bind="visible: playersValue() >= 2">
                    Player 2: <select data-bind="options: availableClasses, value: p2Class"></select>
                </div>
                <div class="startPDiv" data-bind="visible: playersValue() >= 3">
                    Player 3: <select data-bind="options: availableClasses, value: p3Class"></select>
                </div>
                <div class="startPDiv" data-bind="visible: playersValue() >= 4">
                    Player 4: <select data-bind="options: availableClasses, value: p4Class"></select>
                </div>
            </div>
            <button class="phaseButton" data-bind="text: 'Confirm Classes', click: onSetupPhase"></button>
        </div>

        <div id="setupDiv" class="pageDiv" data-bind="visible: isSetupPhase">
            <h1>SETUP PHASE</h1>
            <div>
                Construct your deck. <br>
                Please select 1 card from your tech deck. Then fill the rest with the basic cards. <br>
                Note your deck sizes are a minimum, so you can have more cards if you wish.
            </div>
            <div data-bind="foreach: players">
                <div class="setupContainer">
                    <h3>Player <span data-bind="text: $data.index"></span> - <span data-bind="text: $data.myClass"></span></h3>
                    <div>Deck size: <span data-bind="text: $data.minDeckSize"></span></div>
                    <div class="setupDeck">
                        <h4>Deck</h4>
                        <ul class="playerDeck" data-bind="foreach: $data.allSkills">
                            <li class="playerCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                            click: function(tech, ev) { $parent.removeSkill(tech, ev, $index) }"></li>
                        </ul>
                    </div>
                    <div class="setupDeck">
                        <h4>Tech Deck</h4>
                        <ul class="techDeck" data-bind="foreach: $data.techDeck">
                            <li class="techCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                            click: $parent.learnTech"></li>
                        </ul>
                    </div>
                    <div class="setupDeck">
                        <h4>Basic cards</h4>
                        <ul class="shopDeck" data-bind="foreach: $parent.initialShopCards">
                            <li class="shopCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                            click: $parent.buySkill"></li>
                        </ul>
                    </div>
                </div>
            </div>

            <button class="phaseButton" data-bind="text: 'Confirm Decks', click: onTownPhase"></button>
        </div>

        <div id="playDiv" class="pageDiv" data-bind="visible: isPlayPhase">
            <div class="playerDiv">
                <div class="wdmDiv">
                    WORLD DIFFICULTY METER: <span data-bind="text: WDM"></span>
                    <button class="wdmButton" data-bind="text: '+', click: function() { addWDM(1); }"></button>
                    <button class="wdmButton" data-bind="text: '-', click: function() { addWDM(-1); }"></button>
                </div>
                <div data-bind="foreach: players">
                    <div class="player">
                        <h3>Player <span data-bind="text: $data.index"></span> - <span data-bind="text: $data.myClass"></span></h3>
                        <div class="playerLevel">Level:
                            <span data-bind="text: $data.level"></span>
                            <button class="pDeltaButton" data-bind="text: '+', click: $data.levelUp"></button>
                            <button class="pDeltaButton" data-bind="text: '-', click: $data.levelDown"></button>
                        </div>
                        <div class="playerGold">Gold: 
                            <span data-bind="text: $data.gold"></span>
                            <button class="pDeltaButton" data-bind="text: '+', click: function() {$data.addGold(1); }"></button>
                            <button class="pDeltaButton" data-bind="text: '-', click: function() {$data.addGold(-1); }"></button>
                        </div>
                        <div class="playerButtons">
                            <button class="pButton" data-bind="text: 'Stats', click: function() { $parent.showStatsModal($index) }">
                            <button class="pButton" data-bind="text: 'Deck', click: function() { $parent.showDeckModal($index) }">
                            <button class="pButton" data-bind="text: 'Items', click: function() { $parent.showItemModal($index) }">
                        </div>
                    </div>
                </div>
            </div>
            <div id="townDiv" data-bind="visible: isTownPhase">
                <h1>TOWN PHASE</h1>

                <div class="innShop townShop">
                    <div class="shopTitle" data-bind="text: 'Inn'"></div>
                    <div class="shopSubtitle" data-bind="text: 'Hello traveler, would you like to rest up?'"></div>
                    <span><br/>Cost: </span><span data-bind="text: WDM"></span>
                    <div class="shopContainer">
                        <div class="innImage shopImage"></div>
                        <div class="shopOptions" data-bind="foreach: players">
                            <div class="sPlayerOption">
                                <div class="shopPlayer">Player <span data-bind="text: $data.index"></span></div>
                                <button class="shopButton" data-bind="text: 'Heal', click: function() {$data.heal(); }"></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="marketShop townShop">
                    <div class="shopTitle" data-bind="text: 'Market'"></div>
                    <div class="shopSubtitle" data-bind="text: 'Welcome! See anything you like?'"></div>
                    <div class="shopContainer">
                        <div class="innImage shopImage"></div>
                        <div class="shopOptions" data-bind="foreach: players">
                            <div class="sPlayerOption">
                                <div class="shopPlayer">Player <span data-bind="text: $data.index"></span></div>
                                <button class="shopButton" data-bind="text: 'Buy/Sell', 
                                    click: function() { $parent.showMarketModal($index); }"></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="oracleShop townShop">
                    <div class="shopTitle" data-bind="text: 'Oracle'"></div>
                    <div class="shopSubtitle">
                        Greetings, I've been expecting you. <br/><br/>
                        Learn a new Skill - 3 Gold<br/>
                        Forget a skill - 3 Gold<br/>
                        Random skill - 2 Gold
                    </div>
                    <div class="shopContainer">
                        <div class="innImage shopImage"></div>
                        <div class="shopOptions" data-bind="foreach: players">
                            <div class="sPlayerOption">
                                <div class="shopPlayer">Player <span data-bind="text: $data.index"></span></div>
                                <button class="shopButton" data-bind="text: 'Learn/Forget', 
                                    click: function() { $parent.showSkillChangeModal($index); }"></button>
                                <button class="shopButton" data-bind="text: 'Random skill', 
                                    click: function() { $parent.showSkillRandomModal($index); }"></button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="blacksmithShop townShop">
                    <div class="shopTitle" data-bind="text: 'Blacksmith'"></div>
                    <div class="shopSubtitle" data-bind="text: 'Welcome traveler! Spend the night here to replenish your health. '"></div>
                    <div class="shopContainer">
                        <div class="innImage shopImage"></div>
                        <div class="shopOptions" data-bind="foreach: players">
                            <div class="sPlayerOption">
                                <div class="shopPlayer">Player <span data-bind="text: $data.index"></span></div>
                                <button class="shopButton" data-bind="text: 'Heal'"></button>
                            </div>
                        </div>
                    </div>
                </div> -->

                <button class="phaseButton" data-bind="text: 'Dungeon Adventure', click: onWorldPhase"></button>
            </div>
            
            <div id="worldDiv" data-bind="visible: isWorldPhase, with: overworld">
                <h1>OVERWORLD</h1>
                <div>
                    Please select a dungeon to embark to.
                </div>
                <div data-bind="foreach: dungeons">
                    <div class="worldDungeonDiv bossCard" data-bind="click: function() { $parents[1].onDungeonClick($index); }">
                        <div class="bossStatsContainer">
                            <div class="bossName" data-bind="text: $data.boss.name"></div>
                            <div class="bossPic"></div>
                            <div class="bossHP">HP: <span data-bind="text: $data.boss.hp"></span></div>
                            <div class="bossHP">Attack: <span data-bind="text: $data.boss.attack"></span></div>
                            <div class="bossHP">Defense: <span data-bind="text: $data.boss.defense"></span></div>
                            <!-- <div data-bind="foreach: $data.deck">
                                <div data-bind="text: $data.name"></div>
                            </div> -->
                        </div><!--
                        --><div class="bossSkillsContainer">
                            <ul class="bossSkills" data-bind="foreach: $data.boss.skills">
                                <li class="bossSkillLine" data-bind="text: $data"></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <button class="phaseButton" data-bind="text: 'Return to Town', click: $parent.onTownPhase"></button>
            </div>

            <div id="dungeonDiv" data-bind="visible: isDungeonPhase, with: dungeon">
                <h1>DUNGEON PHASE - <span data-bind="text: $data.boss.name"></span></h1>
                <div class="dungeonDeckContainer">
                    <div class="dungeonDeck">
                        <div class="dungeonDeckBlock" data-bind="click: $data.drawDungeon">
                            <span class="dungeonDeckRemaining" data-bind="text: $data.deck().length"></span>
                        </div>
                        <button data-bind="text: 'undo', click: $data.undrawDungeon"></button>
                    </div>
                    <div class="dungeonPlayed" data-bind="foreach: $data.discard">
                        <div class="dungeonPlayedCard">
                            <span data-bind="text: $data.name"></span>
                        </div>
                    </div>
                </div>
                <div class="playersSection">
                    <div class="activePlayerContainer"></div>
                    <div class="playerContainer">
                        <div data-bind="foreach: $data.players">
                            <div data-bind="text: $data.myClass"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>

    <script id="emptyTemplate" type="text/html"></script>

    <script id="statsModal" type="text/html">
        <div class="modalDiv statsModalDiv">
            <div class="statsLeftContainer">
                <div class="statsTitle">
                    <div class="sPlayer">Player <span data-bind="text: index"></span></div>
                    <div class="sClass" data-bind="text: myClass"></div>
                    <div class="sLevel">Lvl. <span data-bind="text: level"></span></div>
                </div>
                <div class="statsHPBar">
                    <progress class="sHPBar" data-bind="attr: {value: curHP, max: stats.hp}"></progress>
                    <div class="sHPText">
                        <span data-bind="text: curHP"></span>/<span data-bind="text: stats.hp"> HP</span>
                    </div>
                </div>
                <div class="statsImage"></div>
                <div class="statsStats">
                    <div class="sStat">
                        <span class="sStatLabel">Attack:</span>
                        <span class="sStatValue" data-bind="text: stats.attack"></span></div>
                    <div class="sStat">
                        <span class="sStatLabel">Defense:</span>
                        <span class="sStatValue" data-bind="text: stats.defense"></span></div>
                    <div class="sStat">
                        <span class="sStatLabel">HP:</span>
                        <span class="sStatValue" data-bind="text: stats.hp"></span></div>
                    <div class="sStat">
                        <span class="sStatLabel">AP:</span>
                        <span class="sStatValue" data-bind="text: stats.ap"></span></div>
                    <div class="sStat">
                        <span class="sStatLabel">Hand:</span>
                        <span class="sStatValue" data-bind="text: stats.hand"></span></div>
                </div>
            </div>
            <div class="statsRightContainer">
                <div class="statsPassives">
                    <div class="statsPassiveTitle" data-bind="text: 'Passives'"></div>
                    <div class="statsPassive" data-bind="foreach: passives">
                        <div class="passiveName" data-bind="text: $data.name"></div>
                        <div class="passiveDescript" data-bind="text: $data.effect"></div>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <script id="deckModal" type="text/html">
        <div class="modalDiv deckModalDiv" data-bind="foreach: deck">
            <div class="deckCard" data-bind="css: $data.myClass.toLowerCase()">
                <div class="cardTitle">
                    <div class="cardName" data-bind="text: $data.name"></div>
                    <div class="cardCostContainer">
                        <div class="cardCost" data-bind="text: $data.cost"></div>
                    </div>
                </div>
                <div class="cardImage"></div>
                <div class="cardSubtitle">
                    <span class="cardClass" data-bind="text: $data.myClass"></span>
                    <span class="cardLevel" data-bind="text: 'Level ' + $data.level"></span>
                </div>
                <div class="cardEffect" data-bind="text: $data.effect"></div>
            </div>
        </div>
    </script>

    <script id="marketModal" type="text/html">
        <div class="modalDiv transModalDiv">
            <div class="transDescription">
                Total: <span data-bind="text: transactionTotal"></span>
            </div>
            <div class="transDiv setupDeck">
                <h4>Shop</h4>
                <ul class="shopDeck" data-bind="foreach: availShopCards">
                    <li class="shopCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                    click: function(tech, ev) { $parent.buySkill(tech, ev, $index)  }"></li>
                </ul>
            </div>
            <div class="tradeDiv">
                <div class="setupDeck">
                    <h4>Buy</h4>
                    <div>
                        Cost: <span data-bind="text: buyDeckCost"></span>
                    </div>
                    <ul class="buyDeck" data-bind="foreach: buyDeck">
                        <li class="playerCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                        click: function(tech, ev) { $parent.unbuySkill(tech, ev, $index) }"></li>
                    </ul>
                </div>
                <div class="setupDeck">
                    <h4>Sell</h4>
                    <div>
                        Cost: <span data-bind="text: sellDeckCost"></span>
                    </div>
                    <ul class="sellDeck" data-bind="foreach: sellDeck">
                        <li class="playerCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                        click: function(tech, ev) { $parent.unsellSkill(tech, ev, $index) }"></li>
                    </ul>
                </div>
            </div>
            <div class="marketDiv setupDeck">
                <h4>Deck</h4>
                <ul class="playerDeck" data-bind="foreach: playerDeck">
                    <li class="playerCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                    click: function(tech, ev) { $parent.sellSkill(tech, ev, $index) }"></li>
                </ul>
            </div>
            <button class="phaseButton confirmTransaction" data-bind="text: 'Confirm', 
                click: $parent.confirmMarketTransaction"></button>
        </div>
    </script>

    <script id="oracleModal" type="text/html">
        <div class="modalDiv transModalDiv">
            <div class="transDescription">
                Total: <span data-bind="text: transactionTotal"></span>
            </div>
            <div class="transDiv setupDeck">
                <h4>Tech Skills</h4>
                <ul class="shopDeck" data-bind="foreach: availTechCards">
                    <li class="shopCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                    click: function(tech, ev) { $parent.buySkill(tech, ev, $index)  }"></li>
                </ul>
            </div>
            <div class="tradeDiv">
                <div class="setupDeck">
                    <h4>Learn</h4>
                    <div>
                        Cost: <span data-bind="text: buyDeckCost"></span>
                    </div>
                    <ul class="buyDeck" data-bind="foreach: buyDeck">
                        <li class="playerCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                        click: function(tech, ev) { $parent.unbuySkill(tech, ev, $index) }"></li>
                    </ul>
                </div>
                <div class="setupDeck">
                    <h4>Forget</h4>
                    <div>
                        Cost: <span data-bind="text: sellDeckCost"></span>
                    </div>
                    <ul class="sellDeck" data-bind="foreach: sellDeck">
                        <li class="playerCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                        click: function(tech, ev) { $parent.unsellSkill(tech, ev, $index) }"></li>
                    </ul>
                </div>
            </div>
            <div class="transDiv setupDeck">
                <h4>Deck</h4>
                <ul class="playerDeck" data-bind="foreach: playerTechCards">
                    <li class="playerCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                        click: function(tech, ev) { $parent.sellSkill(tech, ev, $index) }"></li>
                </ul>
            </div>
            <button class="phaseButton confirmTransaction" data-bind="text: 'Confirm', 
                click: $parent.confirmOracleTransaction"></button>
        </div>
    </script>

    <script id="oracleRandomModal" type="text/html">
        <div class="modalDiv transModalDiv">
            <div class="transDescription">
                Forget a skill to learn a new random skill!
            </div>
            <div class="transDiv setupDeck">
                <h4>Tech Deck</h4>
                <ul class="shopDeck" data-bind="foreach: availTechCards">
                    <li class="shopCard" data-bind="attr: {title: $data.description}, text: $data.name"></li>
                </ul>
            </div>
            <div class="transDiv setupDeck">
                <h4>Forget</h4>
                <ul class="shopDeck" data-bind="foreach: sellDeck">
                    <li class="shopCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                    click: function(tech, ev) { $parent.unsellSkill(tech, ev, $index) }"></li>
                </ul>
            </div>
            <div class="transDiv setupDeck">
                <h4>Learned Skills</h4>
                <ul class="shopDeck" data-bind="foreach: playerTechCards">
                    <li class="shopCard" data-bind="attr: {title: $data.description}, text: $data.name, 
                    click: function(tech, ev) { $parent.sellSkill(tech, ev, $index) }"></li>
                </ul>
            </div>
            <button class="phaseButton confirmTransaction" data-bind="text: 'Learn random skill', 
                click: $parent.confirmOracleRandomTransaction"></button>
        </div>
    </script>
</html>


